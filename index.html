<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script src="https://cdn.tailwindcss.com"></script>
        <script
            type="text/javascript"
            src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"
        ></script>
        <script src="https://www.google.com/recaptcha/api.js?render=6LfPu-AnAAAAAL22c22WI7lGoeMXjFnuIkk8CKuV"></script>
        <title>Prueba Krak</title>
    </head>
    <body class="bg-gray-300">
        <script>
            let canSend = true

            ;(function () {
                emailjs.init('ck9zPDsmdkeGhwQge')
            })()

            window.onload = function () {
                document
                    .getElementById('form')
                    .addEventListener('submit', formHandler)
            }
            function formHandler(event) {
                event.preventDefault()
                if (canSend) {
                    canSend = false

                    grecaptcha.ready(function () {
                        const btn = document.getElementById('submit-button')

                        btn.value = 'Enviando...'

                        console.log('good')

                        grecaptcha
                            .execute(
                                '6LfPu-AnAAAAAL22c22WI7lGoeMXjFnuIkk8CKuV',
                                {
                                    action: 'submit',
                                }
                            )
                            .then(function (token) {
                                const serviceID = 'default_service'
                                const templateID = 'template_o5f1c2q'

                                emailjs
                                    .sendForm(
                                        serviceID,
                                        templateID,
                                        document.getElementById('form')
                                    )
                                    .then(
                                        () => {
                                            btn.value = 'Enviado'
                                            btn.style.backgroundColor = 'green'
                                            btn.disabled = true

                                            document
                                                .getElementById('form')
                                                .removeEventListener(
                                                    'submit',
                                                    formHandler
                                                )
                                        },
                                        (err) => {
                                            btn.value = 'Error'
                                            btn.style.backgroundColor = 'red'
                                        }
                                    )
                                    .finally(() => {
                                        canSend = true
                                    })
                            })
                    })
                }
            }
        </script>
        <main class="p-16 flex justify-center gap-4">
            <form
                method="post"
                class="p-8 border mt-4 border-gray-800 border-b-4 flex flex-col gap-4 max-w-2xl w-full bg-white shadow-lg"
                id="form"
            >
                <label class="flex flex-col gap-1">
                    <span class="text-sm font-bold text-gray-500">
                        Nombre
                    </span>
                    <input
                        required
                        name="name"
                        class="shadow-inner border border-gray-400 rounded py-1 px-4"
                        type="text"
                        placeholder="Juan Ejemplo Rolon"
                    />
                </label>
                <label class="flex flex-col gap-1">
                    <span class="text-sm font-bold text-gray-500"> Mail </span>
                    <input
                        required
                        name="email"
                        class="shadow-inner border border-gray-400 rounded py-1 px-4"
                        type="email"
                        placeholder="juan@ejemplo.com"
                    />
                </label>
                <label class="flex flex-col gap-1">
                    <span class="text-sm font-bold text-gray-500">
                        Mensaje
                    </span>
                    <textarea
                        required
                        name="message"
                        placeholder="Aqui va su mensaje."
                        class="w-full border border-gray-400 shadow-inner rounded py-1 px-4"
                        rows="4"
                    ></textarea>
                </label>
                <input
                    type="submit"
                    class="g-recaptcha mt-2 px-4 shadow-md hover:bg-black hover:shadow-lg hover:-translate-y-0.5 transition-all hover:cursor-pointer py-2 rounded w-fit self-end bg-gray-800 text-gray-200 font-bold uppercase tracking-wide"
                    id="submit-button"
                    value="Enviar"
                />
            </form>
        </main>
    </body>
</html>
